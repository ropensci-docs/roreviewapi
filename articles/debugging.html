<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Debugging the package check API • roreviewapi</title>
<!-- rOpenSci favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Debugging the package check API">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.css">
<script src="https://cdn.jsdelivr.net/gh/orestbida/cookieconsent@v3.0.0/dist/cookieconsent.umd.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">roreviewapi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.0.058</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"></ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/debugging.html">Debugging the package check API</a></li>
    <li><a class="dropdown-item" href="../articles/endpoints.html">API Endpoints</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ropensci-review-tools/roreviewapi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Debugging the package check API</h1>
                        <h4 data-toc-skip class="author">Mark
Padgham</h4>
            
            <h4 data-toc-skip class="date">2024-10-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci-review-tools/roreviewapi/blob/master/vignettes/debugging.Rmd" class="external-link"><code>vignettes/debugging.Rmd</code></a></small>
      <div class="d-none name"><code>debugging.Rmd</code></div>
    </div>

    
    
<p>The main API endpoint for the Digital Ocean server is the <a href="https://docs.ropensci.org/roreviewapi/articles/endpoints.html#editorcheck"><code>editorcheck</code></a>,
called by the <code>ropensci-review-bot</code> on every submission, and
also manually (re-)triggered by the command
<code>@ropensci-review-bot check package</code>. This vignette describes
procedures which may be used to debug any instances in which package
checks fail.</p>
<p>Most failures at the server end will deliver HTTP error codes of
“500” <a href="https://github.com/ropensci/software-review/issues/463#issuecomment-920941332" class="external-link">like
this example</a>. This code <em>may</em> indicate that the server is
currently unavailable, which will arise once per week during rebuild and
redeploy processes, scheduled every Monday at 23:59 UTC. If a submission
happens to be roughly at this time, the recommended procedure is to wait
at least an hour before manually trying
<code>@ropensci-review-bot check package</code>. Other 500 codes should
be reported straight to maintainers of the check system, currently to <a href="https://github.com/mpadge" class="external-link">@mpadge</a> and <a href="https://github.com/noamross" class="external-link">@noamross</a> as respective first and
second points of contact. This vignette describes the procedures they
would follow to debug any problems.</p>
<p>Debugging generally requires stepping through the code as called by
the main <a href="https://github.com/ropensci-review-tools/roreviewapi/blob/main/R/plumber.R" class="external-link"><code>editorcheck</code>
endpoint</a>, and into the <a href="https://github.com/ropensci-review-tools/roreviewapi/blob/main/R/editor-check.R" class="external-link"><code>editor_check()</code>
function</a> called by the endpoint as a background process.</p>
<div class="section level2">
<h2 id="debugging-procedure">Debugging Procedure<a class="anchor" aria-label="anchor" href="#debugging-procedure"></a>
</h2>
<div class="section level3">
<h3 id="check-that-the-api-is-online">Check that the API is online<a class="anchor" aria-label="anchor" href="#check-that-the-api-is-online"></a>
</h3>
<p>The following code will confirm that the API is online, by returning
a single numeric value:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/GET.html" class="external-link">GET</a></span> <span class="op">(</span><span class="st">"http://&lt;ip-address&gt;:8000/mean"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">httr</span><span class="fu">::</span><span class="fu"><a href="https://httr.r-lib.org/reference/content.html" class="external-link">content</a></span> <span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="check-log-of-recent-requests">Check log of recent requests<a class="anchor" aria-label="anchor" href="#check-log-of-recent-requests"></a>
</h3>
<p>The log entries are illustrated in the <a href="https://docs.ropensci.org/roreviewapi/articles/endpoints.html#5-log">endpoints
vignette</a>, and can be used to ensure that all variables were
successfully delivered in the request. Any missing or malformed
variables most likely indicate problems with the submission template.
These should be caught by the initial call make by the <a href="https://github.com/ropensci-review-tools/roreviewapi/blob/82c9724a712094e4ccabb3974cb952f68ad5180f/R/plumber.R#L23" class="external-link"><code>editorcheck</code>
function to the <code>check_issue_template()</code> function</a>.
Potential issues can be debugged by calling that function locally:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>roreviewapi<span class="sc">::</span><span class="fu">check_issue_template</span> (<span class="at">orgrepo =</span> <span class="st">"ropensci/software-review"</span>,</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>                                   <span class="at">issue_num =</span> <span class="sc">&lt;</span>issue_num<span class="sc">&gt;</span>)</span></code></pre></div>
<p>That should return an empty string with an additional attribute,
<code>"proceed_with_checks"</code>, which should be <code>TRUE</code>.
Any other return value indicates an issue with the submission template,
for which the return value should contain text describing the
problem.</p>
</div>
<div class="section level3">
<h3 id="check-installation-of-system-dependencies">Check installation of system dependencies<a class="anchor" aria-label="anchor" href="#check-installation-of-system-dependencies"></a>
</h3>
<p>This and the following checks are components of the <a href="https://github.com/ropensci-review-tools/roreviewapi/blob/main/R/editor-check.R" class="external-link"><code>editor_check()</code>
function</a> called by the main endpoint as a background process, the
first step of which is to identify and install system dependencies. This
step is error prone, as is also the case on all CRAN machines. A final
step of the check is to identify any packages which were unable to be
installed, and to post a list of these directly in the submission issue.
Such instances should generally be temporary, and fixed by forthcoming
CRAN updates. These happen because of temporary breakages in one package
which lead to other packages becoming unable to be installed from CRAN,
with these temporary breakages in turn generally arising because of
changes to external (non-R) system libraries. If any notified
inabilities to install packages adversely affect final check results,
debugging may require manually running checks on the Digital Ocean
server, as described in the final section below.</p>
</div>
<div class="section level3">
<h3 id="check-system-output-and-error-logs">Check system output and error logs<a class="anchor" aria-label="anchor" href="#check-system-output-and-error-logs"></a>
</h3>
<p>The system output and error logs from checks for a specified package
are accessible from <a href="https://docs.ropensci.org/roreviewapi/articles/endpoints.html#7-stdlogs">the
<code>stdlogs</code> endpoint</a>, which requires the single parameter
of the <code>repourl</code> of the repository being checked. Logs are
kept for the latest git head, and are accessible if and only if the
latest GitHub commit matches the points at which the logs were
generated. In those cases, the return value may offer useful diagnostic
insights into potential problems either with submitted packages, or the
check system itself.</p>
</div>
</div>
<div class="section level2">
<h2 id="manually-running-checks">Manually running checks<a class="anchor" aria-label="anchor" href="#manually-running-checks"></a>
</h2>
<p>If all else fails, checks can be manually run directly from the
Digital Ocean server, and sent straight to the relevant issue. The
following procedure describe how, generally following the main <a href="https://github.com/ropensci-review-tools/roreviewapi/blob/main/R/editor-check.R" class="external-link"><code>editor_check()</code>
function</a>.</p>
<ol style="list-style-type: decimal">
<li>Enter the <code>roreviewapi</code> Docker image via
<code>docker run -it --rm roreviewapi /bin/bash</code> and start R.</li>
<li>Set <code>repourl &lt;- &lt;url&gt;</code> and run
<code>path &lt;- roreviewapi::dl_gh_repo (repourl)</code> to download a
clone of the repository.</li>
<li>Type <code>os &lt;- "ubuntu"</code> and
<code>os_release &lt;- "20.04"</code>.</li>
<li>Run
<code>p &lt;- roreviewapi::pkgrep_install_deps (path, os, os_release)</code>.
The value, <code>p</code>, will list any packages which were unable to
be installed. These will then need to be manually installed, generally
through finding the remote/dev URLs for the packages, and running
<code><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">remotes::install_github()</a></code> or similar. Note that successful
installation may only be possible in a particular order, and in the
worst cases may be a process of trial and error.</li>
<li>Finally generate the main checks by running
<code>checks &lt;- pkgcheck::pkgcheck(path)</code>, during which
diagnostic output will be dumped directly to the screen.</li>
<li>Convert checks to markdown format by running
<code>out &lt;- roreviewapi::collate_editor_check (checks)</code>.</li>
<li>Finally, post the checks to the desired issue with
<code>out &lt;- roreviewapi::post_to_issue (out, orgrepo, issue_num)</code>.
Alternative values for <code>orgrepo</code> and <code>issue_num</code>
can be used to first confirm that the checks look okay before posting
them to <code>ropensci/software-review</code>.</li>
</ol>
<p>These steps can be run in two code chunks, the first directly in the
shell environment of the Digital Ocean droplet:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-it</span> <span class="at">--rm</span> roreviewapi /bin/bash</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="ex">R</span></span></code></pre></div>
<p>And the second within the R environment:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">repourl</span> <span class="op">&lt;-</span> <span class="st">"https://github.com/org/repo"</span> <span class="co"># replace with actual org/repo values</span></span>
<span><span class="va">path</span> <span class="op">&lt;-</span> <span class="fu">roreviewapi</span><span class="fu">::</span><span class="fu"><a href="../reference/dl_gh_repo.html">dl_gh_repo</a></span> <span class="op">(</span><span class="va">repourl</span><span class="op">)</span></span>
<span><span class="va">os</span> <span class="op">&lt;-</span> <span class="st">"ubuntu"</span></span>
<span><span class="va">os_release</span> <span class="op">&lt;-</span> <span class="st">"20.04"</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu">roreviewapi</span><span class="fu">::</span><span class="fu"><a href="../reference/pkgrep_install_deps.html">pkgrep_install_deps</a></span> <span class="op">(</span><span class="va">path</span>, <span class="va">os</span>, <span class="va">os_release</span><span class="op">)</span></span>
<span><span class="va">checks</span> <span class="op">&lt;-</span> <span class="fu">pkgcheck</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/pkgcheck/reference/pkgcheck.html" class="external-link">pkgcheck</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">roreviewapi</span><span class="fu">::</span><span class="fu"><a href="../reference/collate_editor_check.html">collate_editor_check</a></span> <span class="op">(</span><span class="va">checks</span><span class="op">)</span></span>
<span><span class="va">orgrepo</span> <span class="op">&lt;-</span> <span class="st">"ropensci/software-review"</span> <span class="co"># or somewhere else for testing purposes</span></span>
<span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">roreviewapi</span><span class="fu">::</span><span class="fu"><a href="../reference/post_to_issue.html">post_to_issue</a></span> <span class="op">(</span><span class="va">out</span>, <span class="va">orgrepo</span>, <span class="va">issue_num</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://hachyderm.io/@ropensci" target="_blank" class="external-link"><div class="icon fab fa-mastodon"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>





  </body>
</html>
